{"version":3,"file":"3b134d76ef26f7542380.chunk.js","mappings":"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","sources":["webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/explore.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/safeStringify.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/index.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/Multi/Multi.jsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Geojson/Geojson.jsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Grid/Grid.jsx","webpack://superset/./node_modules/d3-hexbin/src/hexbin.js","webpack://superset/./node_modules/@deck.gl/aggregation-layers/dist/esm/hexagon-layer/hexagon-layer.js","webpack://superset/./node_modules/@deck.gl/aggregation-layers/dist/esm/hexagon-layer/hexagon-aggregator.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Hex/Hex.jsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Path/Path.jsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/geo.js","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Scatter/Scatter.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport URI from 'urijs';\nimport { safeStringify } from './safeStringify';\n\nconst MAX_URL_LENGTH = 8000;\n\nexport function getURIDirectory(formData, endpointType = 'base') {\n  // Building the directory part of the URI\n  let directory = '/superset/explore/';\n  if (['json', 'csv', 'query', 'results', 'samples'].includes(endpointType)) {\n    directory = '/superset/explore_json/';\n  }\n\n  return directory;\n}\n\nexport function getExploreLongUrl(\n  formData,\n  endpointType,\n  allowOverflow = true,\n  extraSearch = {},\n) {\n  if (!formData.datasource) {\n    return null;\n  }\n\n  const uri = new URI('/');\n  const directory = getURIDirectory(formData, endpointType);\n  const search = uri.search(true);\n  Object.keys(extraSearch).forEach(key => {\n    search[key] = extraSearch[key];\n  });\n  search.form_data = safeStringify(formData);\n  if (endpointType === 'standalone') {\n    search.standalone = 'true';\n  }\n  const url = uri.directory(directory).search(search).toString();\n  if (!allowOverflow && url.length > MAX_URL_LENGTH) {\n    const minimalFormData = {\n      datasource: formData.datasource,\n      viz_type: formData.viz_type,\n    };\n\n    return getExploreLongUrl(minimalFormData, endpointType, false, {\n      URL_IS_TOO_LONG_TO_SHARE: null,\n    });\n  }\n\n  return url;\n}\n","/* eslint-disable consistent-return */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * A Stringify function that will not crash when it runs into circular JSON references,\n * unlike JSON.stringify. Any circular references are simply omitted, as if there had\n * been no data present\n * @param object any JSON object to be stringified\n */\n\n// eslint-disable-next-line import/prefer-default-export\nexport function safeStringify(object) {\n  const cache = new Set();\n\n  return JSON.stringify(object, (key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (cache.has(value)) {\n        // We've seen this object before\n        try {\n          // Quick deep copy to duplicate if this is a repeat rather than a circle.\n          return JSON.parse(JSON.stringify(value));\n        } catch (error) {\n          // Discard key if value cannot be duplicated.\n          return;\n        }\n      }\n      // Store the value in our cache.\n      cache.add(value);\n    }\n\n    return value;\n  });\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { getLayer as deck_grid } from './Grid/Grid';\nimport { getLayer as deck_screengrid } from './Screengrid/Screengrid';\nimport { getLayer as deck_path } from './Path/Path';\nimport { getLayer as deck_hex } from './Hex/Hex';\nimport { getLayer as deck_scatter } from './Scatter/Scatter';\nimport { getLayer as deck_geojson } from './Geojson/Geojson';\nimport { getLayer as deck_arc } from './Arc/Arc';\nimport { getLayer as deck_polygon } from './Polygon/Polygon';\n\nconst layerGenerators = {\n  deck_grid,\n  deck_screengrid,\n  deck_path,\n  deck_hex,\n  deck_scatter,\n  deck_geojson,\n  deck_arc,\n  deck_polygon,\n};\n\nexport default layerGenerators;\n","/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/no-access-state-in-setstate */\n/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport { SupersetClient } from '@superset-ui/core';\n\nimport { DeckGLContainerStyledWrapper } from '../DeckGLContainer';\nimport { getExploreLongUrl } from '../utils/explore';\nimport layerGenerators from '../layers';\n\nconst propTypes = {\n  formData: PropTypes.object.isRequired,\n  payload: PropTypes.object.isRequired,\n  setControlValue: PropTypes.func.isRequired,\n  viewport: PropTypes.object.isRequired,\n  onAddFilter: PropTypes.func,\n  onSelect: PropTypes.func,\n};\nconst defaultProps = {\n  onAddFilter() {},\n  onSelect() {},\n};\n\nclass DeckMulti extends React.PureComponent {\n  containerRef = React.createRef();\n\n  constructor(props) {\n    super(props);\n    this.state = { subSlicesLayers: {} };\n    this.onViewportChange = this.onViewportChange.bind(this);\n  }\n\n  componentDidMount() {\n    const { formData, payload } = this.props;\n    this.loadLayers(formData, payload);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const { formData, payload } = nextProps;\n    const hasChanges = !_.isEqual(\n      this.props.formData.deck_slices,\n      nextProps.formData.deck_slices,\n    );\n    if (hasChanges) {\n      this.loadLayers(formData, payload);\n    }\n  }\n\n  onViewportChange(viewport) {\n    this.setState({ viewport });\n  }\n\n  loadLayers(formData, payload, viewport) {\n    this.setState({ subSlicesLayers: {}, viewport });\n    payload.data.slices.forEach(subslice => {\n      // Filters applied to multi_deck are passed down to underlying charts\n      // note that dashboard contextual information (filter_immune_slices and such) aren't\n      // taken into consideration here\n      const filters = [\n        ...(subslice.form_data.filters || []),\n        ...(formData.filters || []),\n        ...(formData.extra_filters || []),\n      ];\n      const subsliceCopy = {\n        ...subslice,\n        form_data: {\n          ...subslice.form_data,\n          filters,\n        },\n      };\n\n      SupersetClient.get({\n        endpoint: getExploreLongUrl(subsliceCopy.form_data, 'json'),\n      })\n        .then(({ json }) => {\n          const layer = layerGenerators[subsliceCopy.form_data.viz_type](\n            subsliceCopy.form_data,\n            json,\n            this.props.onAddFilter,\n            this.setTooltip,\n            [],\n            this.props.onSelect,\n          );\n          this.setState({\n            subSlicesLayers: {\n              ...this.state.subSlicesLayers,\n              [subsliceCopy.slice_id]: layer,\n            },\n          });\n        })\n        .catch(() => {});\n    });\n  }\n\n  setTooltip = tooltip => {\n    const { current } = this.containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  };\n\n  render() {\n    const { payload, formData, setControlValue, height, width } = this.props;\n    const { subSlicesLayers } = this.state;\n\n    const layers = Object.values(subSlicesLayers);\n\n    return (\n      <DeckGLContainerStyledWrapper\n        ref={this.containerRef}\n        mapboxApiAccessToken={payload.data.mapboxApiKey}\n        viewport={this.state.viewport || this.props.viewport}\n        layers={layers}\n        mapStyle={formData.mapbox_style}\n        setControlValue={setControlValue}\n        onViewportChange={this.onViewportChange}\n        height={height}\n        width={width}\n      />\n    );\n  }\n}\n\nDeckMulti.propTypes = propTypes;\nDeckMulti.defaultProps = defaultProps;\n\nexport default DeckMulti;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { GeoJsonLayer } from 'deck.gl';\nimport geojsonExtent from '@mapbox/geojson-extent';\n\nimport { DeckGLContainerStyledWrapper } from '../../DeckGLContainer';\nimport { hexToRGB } from '../../utils/colors';\nimport sandboxedEval from '../../utils/sandbox';\nimport { commonLayerProps } from '../common';\nimport TooltipRow from '../../TooltipRow';\nimport fitViewport from '../../utils/fitViewport';\n\nconst propertyMap = {\n  fillColor: 'fillColor',\n  color: 'fillColor',\n  fill: 'fillColor',\n  'fill-color': 'fillColor',\n  strokeColor: 'strokeColor',\n  'stroke-color': 'strokeColor',\n  'stroke-width': 'strokeWidth',\n};\n\nconst alterProps = (props, propOverrides) => {\n  const newProps = {};\n  Object.keys(props).forEach(k => {\n    if (k in propertyMap) {\n      newProps[propertyMap[k]] = props[k];\n    } else {\n      newProps[k] = props[k];\n    }\n  });\n  if (typeof props.fillColor === 'string') {\n    newProps.fillColor = hexToRGB(props.fillColor);\n  }\n  if (typeof props.strokeColor === 'string') {\n    newProps.strokeColor = hexToRGB(props.strokeColor);\n  }\n\n  return {\n    ...newProps,\n    ...propOverrides,\n  };\n};\nlet features;\nconst recurseGeoJson = (node, propOverrides, extraProps) => {\n  if (node && node.features) {\n    node.features.forEach(obj => {\n      recurseGeoJson(obj, propOverrides, node.extraProps || extraProps);\n    });\n  }\n  if (node && node.geometry) {\n    const newNode = {\n      ...node,\n      properties: alterProps(node.properties, propOverrides),\n    };\n    if (!newNode.extraProps) {\n      newNode.extraProps = extraProps;\n    }\n    features.push(newNode);\n  }\n};\n\nfunction setTooltipContent(o) {\n  return (\n    o.object.extraProps && (\n      <div className=\"deckgl-tooltip\">\n        {Object.keys(o.object.extraProps).map((prop, index) => (\n          <TooltipRow\n            key={`prop-${index}`}\n            label={`${prop}: `}\n            value={`${o.object.extraProps[prop]}`}\n          />\n        ))}\n      </div>\n    )\n  );\n}\n\nconst getFillColor = feature => feature?.properties?.fillColor;\nconst getLineColor = feature => feature?.properties?.strokeColor;\n\nexport function getLayer(formData, payload, onAddFilter, setTooltip) {\n  const fd = formData;\n  const fc = fd.fill_color_picker;\n  const sc = fd.stroke_color_picker;\n  const fillColor = [fc.r, fc.g, fc.b, 255 * fc.a];\n  const strokeColor = [sc.r, sc.g, sc.b, 255 * sc.a];\n  const propOverrides = {};\n  if (fillColor[3] > 0) {\n    propOverrides.fillColor = fillColor;\n  }\n  if (strokeColor[3] > 0) {\n    propOverrides.strokeColor = strokeColor;\n  }\n\n  features = [];\n  recurseGeoJson(payload.data, propOverrides);\n\n  let jsFnMutator;\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    features = jsFnMutator(features);\n  }\n\n  return new GeoJsonLayer({\n    id: `geojson-layer-${fd.slice_id}`,\n    filled: fd.filled,\n    data: features,\n    stroked: fd.stroked,\n    extruded: fd.extruded,\n    pointRadiusScale: fd.point_radius_scale,\n    getFillColor,\n    getLineWidth: fd.line_width || 1,\n    getLineColor,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nconst propTypes = {\n  formData: PropTypes.object.isRequired,\n  payload: PropTypes.object.isRequired,\n  setControlValue: PropTypes.func.isRequired,\n  viewport: PropTypes.object.isRequired,\n  onAddFilter: PropTypes.func,\n};\nconst defaultProps = {\n  onAddFilter() {},\n};\n\nclass DeckGLGeoJson extends React.Component {\n  containerRef = React.createRef();\n\n  setTooltip = tooltip => {\n    const { current } = this.containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  };\n\n  render() {\n    const { formData, payload, setControlValue, onAddFilter, height, width } =\n      this.props;\n\n    let { viewport } = this.props;\n    if (formData.autozoom) {\n      const points =\n        payload?.data?.features?.reduce?.((acc, feature) => {\n          const bounds = geojsonExtent(feature);\n          if (bounds) {\n            return [...acc, [bounds[0], bounds[1]], [bounds[2], bounds[3]]];\n          }\n\n          return acc;\n        }, []) || [];\n\n      if (points.length) {\n        viewport = fitViewport(viewport, {\n          width,\n          height,\n          points,\n        });\n      }\n    }\n\n    const layer = getLayer(formData, payload, onAddFilter, this.setTooltip);\n\n    return (\n      <DeckGLContainerStyledWrapper\n        ref={this.containerRef}\n        mapboxApiAccessToken={payload.data.mapboxApiKey}\n        viewport={viewport}\n        layers={[layer]}\n        mapStyle={formData.mapbox_style}\n        setControlValue={setControlValue}\n        height={height}\n        width={width}\n      />\n    );\n  }\n}\n\nDeckGLGeoJson.propTypes = propTypes;\nDeckGLGeoJson.defaultProps = defaultProps;\n\nexport default DeckGLGeoJson;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { GridLayer } from 'deck.gl';\nimport React from 'react';\nimport { t } from '@superset-ui/core';\n\nimport { commonLayerProps, getAggFunc } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { createDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\n\nfunction setTooltipContent(o) {\n  return (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        label={`${t('Longitude and Latitude')}: `}\n        value={`${o.coordinate[0]}, ${o.coordinate[1]}`}\n      />\n      <TooltipRow\n        label={`${t('Height')}: `}\n        value={`${o.object.elevationValue}`}\n      />\n    </div>\n  );\n}\n\nexport function getLayer(formData, payload, onAddFilter, setTooltip) {\n  const fd = formData;\n  const c = fd.color_picker;\n  let data = payload.data.features.map(d => ({\n    ...d,\n    color: [c.r, c.g, c.b, 255 * c.a],\n  }));\n\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n\n  const aggFunc = getAggFunc(fd.js_agg_function, p => p.weight);\n\n  return new GridLayer({\n    id: `grid-layer-${fd.slice_id}`,\n    data,\n    pickable: true,\n    cellSize: fd.grid_size,\n    minColor: [0, 0, 0, 0],\n    extruded: fd.extruded,\n    maxColor: [c.r, c.g, c.b, 255 * c.a],\n    outline: false,\n    getElevationValue: aggFunc,\n    getColorValue: aggFunc,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nfunction getPoints(data) {\n  return data.map(d => d.position);\n}\n\nexport default createDeckGLComponent(getLayer, getPoints);\n","var thirdPi = Math.PI / 3,\n    angles = [0, thirdPi, 2 * thirdPi, 3 * thirdPi, 4 * thirdPi, 5 * thirdPi];\n\nfunction pointX(d) {\n  return d[0];\n}\n\nfunction pointY(d) {\n  return d[1];\n}\n\nexport default function() {\n  var x0 = 0,\n      y0 = 0,\n      x1 = 1,\n      y1 = 1,\n      x = pointX,\n      y = pointY,\n      r,\n      dx,\n      dy;\n\n  function hexbin(points) {\n    var binsById = {}, bins = [], i, n = points.length;\n\n    for (i = 0; i < n; ++i) {\n      if (isNaN(px = +x.call(null, point = points[i], i, points))\n          || isNaN(py = +y.call(null, point, i, points))) continue;\n\n      var point,\n          px,\n          py,\n          pj = Math.round(py = py / dy),\n          pi = Math.round(px = px / dx - (pj & 1) / 2),\n          py1 = py - pj;\n\n      if (Math.abs(py1) * 3 > 1) {\n        var px1 = px - pi,\n            pi2 = pi + (px < pi ? -1 : 1) / 2,\n            pj2 = pj + (py < pj ? -1 : 1),\n            px2 = px - pi2,\n            py2 = py - pj2;\n        if (px1 * px1 + py1 * py1 > px2 * px2 + py2 * py2) pi = pi2 + (pj & 1 ? 1 : -1) / 2, pj = pj2;\n      }\n\n      var id = pi + \"-\" + pj, bin = binsById[id];\n      if (bin) bin.push(point);\n      else {\n        bins.push(bin = binsById[id] = [point]);\n        bin.x = (pi + (pj & 1) / 2) * dx;\n        bin.y = pj * dy;\n      }\n    }\n\n    return bins;\n  }\n\n  function hexagon(radius) {\n    var x0 = 0, y0 = 0;\n    return angles.map(function(angle) {\n      var x1 = Math.sin(angle) * radius,\n          y1 = -Math.cos(angle) * radius,\n          dx = x1 - x0,\n          dy = y1 - y0;\n      x0 = x1, y0 = y1;\n      return [dx, dy];\n    });\n  }\n\n  hexbin.hexagon = function(radius) {\n    return \"m\" + hexagon(radius == null ? r : +radius).join(\"l\") + \"z\";\n  };\n\n  hexbin.centers = function() {\n    var centers = [],\n        j = Math.round(y0 / dy),\n        i = Math.round(x0 / dx);\n    for (var y = j * dy; y < y1 + r; y += dy, ++j) {\n      for (var x = i * dx + (j & 1) * dx / 2; x < x1 + dx / 2; x += dx) {\n        centers.push([x, y]);\n      }\n    }\n    return centers;\n  };\n\n  hexbin.mesh = function() {\n    var fragment = hexagon(r).slice(0, 4).join(\"l\");\n    return hexbin.centers().map(function(p) { return \"M\" + p + \"m\" + fragment; }).join(\"\");\n  };\n\n  hexbin.x = function(_) {\n    return arguments.length ? (x = _, hexbin) : x;\n  };\n\n  hexbin.y = function(_) {\n    return arguments.length ? (y = _, hexbin) : y;\n  };\n\n  hexbin.radius = function(_) {\n    return arguments.length ? (r = +_, dx = r * 2 * Math.sin(thirdPi), dy = r * 1.5, hexbin) : r;\n  };\n\n  hexbin.size = function(_) {\n    return arguments.length ? (x0 = y0 = 0, x1 = +_[0], y1 = +_[1], hexbin) : [x1 - x0, y1 - y0];\n  };\n\n  hexbin.extent = function(_) {\n    return arguments.length ? (x0 = +_[0][0], y0 = +_[0][1], x1 = +_[1][0], y1 = +_[1][1], hexbin) : [[x0, y0], [x1, y1]];\n  };\n\n  return hexbin.radius(1);\n}\n","import { log } from '@deck.gl/core';\nimport { ColumnLayer } from '@deck.gl/layers';\nimport { defaultColorRange } from '../utils/color-utils';\nimport { pointToHexbin } from './hexagon-aggregator';\nimport CPUAggregator from '../utils/cpu-aggregator';\nimport AggregationLayer from '../aggregation-layer';\n\nfunction nop() {}\n\nconst defaultProps = {\n  colorDomain: null,\n  colorRange: defaultColorRange,\n  getColorValue: {\n    type: 'accessor',\n    value: null\n  },\n  getColorWeight: {\n    type: 'accessor',\n    value: 1\n  },\n  colorAggregation: 'SUM',\n  lowerPercentile: {\n    type: 'number',\n    value: 0,\n    min: 0,\n    max: 100\n  },\n  upperPercentile: {\n    type: 'number',\n    value: 100,\n    min: 0,\n    max: 100\n  },\n  colorScaleType: 'quantize',\n  onSetColorDomain: nop,\n  elevationDomain: null,\n  elevationRange: [0, 1000],\n  getElevationValue: {\n    type: 'accessor',\n    value: null\n  },\n  getElevationWeight: {\n    type: 'accessor',\n    value: 1\n  },\n  elevationAggregation: 'SUM',\n  elevationLowerPercentile: {\n    type: 'number',\n    value: 0,\n    min: 0,\n    max: 100\n  },\n  elevationUpperPercentile: {\n    type: 'number',\n    value: 100,\n    min: 0,\n    max: 100\n  },\n  elevationScale: {\n    type: 'number',\n    min: 0,\n    value: 1\n  },\n  elevationScaleType: 'linear',\n  onSetElevationDomain: nop,\n  radius: {\n    type: 'number',\n    value: 1000,\n    min: 1\n  },\n  coverage: {\n    type: 'number',\n    min: 0,\n    max: 1,\n    value: 1\n  },\n  extruded: false,\n  hexagonAggregator: pointToHexbin,\n  getPosition: {\n    type: 'accessor',\n    value: x => x.position\n  },\n  material: true,\n  _filterData: {\n    type: 'function',\n    value: null,\n    optional: true\n  }\n};\nexport default class HexagonLayer extends AggregationLayer {\n  shouldUpdateState({\n    changeFlags\n  }) {\n    return changeFlags.somethingChanged;\n  }\n\n  initializeState() {\n    const cpuAggregator = new CPUAggregator({\n      getAggregator: props => props.hexagonAggregator,\n      getCellSize: props => props.radius\n    });\n    this.state = {\n      cpuAggregator,\n      aggregatorState: cpuAggregator.state,\n      hexagonVertices: null\n    };\n    const attributeManager = this.getAttributeManager();\n    attributeManager.add({\n      positions: {\n        size: 3,\n        accessor: 'getPosition'\n      }\n    });\n  }\n\n  updateState(opts) {\n    super.updateState(opts);\n    const {\n      cpuAggregator,\n      hexagonVertices: oldVertices\n    } = this.state;\n\n    if (opts.changeFlags.propsOrDataChanged) {\n      this.setState({\n        aggregatorState: cpuAggregator.updateState(opts, {\n          viewport: this.context.viewport,\n          attributes: this.getAttributes()\n        })\n      });\n    }\n\n    const {\n      hexagonVertices\n    } = cpuAggregator.state.layerData || {};\n\n    if (hexagonVertices && oldVertices !== hexagonVertices) {\n      const vertices = this.convertLatLngToMeterOffset(hexagonVertices);\n\n      if (vertices) {\n        this.setState({\n          hexagonVertices,\n          vertices\n        });\n      }\n    } else {\n      this.updateRadiusAngle();\n    }\n  }\n\n  updateRadiusAngle(vertices) {\n    const {\n      viewport\n    } = this.context;\n    const {\n      unitsPerMeter\n    } = viewport.getDistanceScales();\n    const {\n      cpuAggregator\n    } = this.state;\n\n    if (cpuAggregator.state.layerData && cpuAggregator.state.layerData.radiusCommon) {\n      const {\n        radiusCommon\n      } = cpuAggregator.state.layerData;\n      const radius = radiusCommon / unitsPerMeter[0];\n      this.setState({\n        angle: 90,\n        radius\n      });\n    }\n  }\n\n  convertLatLngToMeterOffset(hexagonVertices) {\n    const {\n      viewport\n    } = this.context;\n\n    if (Array.isArray(hexagonVertices) && hexagonVertices.length === 6) {\n      const vertex0 = hexagonVertices[0];\n      const vertex3 = hexagonVertices[3];\n      const centroid = [(vertex0[0] + vertex3[0]) / 2, (vertex0[1] + vertex3[1]) / 2];\n      const centroidFlat = viewport.projectFlat(centroid);\n      const {\n        metersPerUnit\n      } = viewport.getDistanceScales(centroid);\n      const vertices = hexagonVertices.map(vt => {\n        const vtFlat = viewport.projectFlat(vt);\n        return [(vtFlat[0] - centroidFlat[0]) * metersPerUnit[0], (vtFlat[1] - centroidFlat[1]) * metersPerUnit[1]];\n      });\n      return vertices;\n    }\n\n    log.error('HexagonLayer: hexagonVertices needs to be an array of 6 points')();\n    return null;\n  }\n\n  getPickingInfo({\n    info\n  }) {\n    return this.state.cpuAggregator.getPickingInfo({\n      info\n    });\n  }\n\n  _onGetSublayerColor(cell) {\n    return this.state.cpuAggregator.getAccessor('fillColor')(cell);\n  }\n\n  _onGetSublayerElevation(cell) {\n    return this.state.cpuAggregator.getAccessor('elevation')(cell);\n  }\n\n  _getSublayerUpdateTriggers() {\n    return this.state.cpuAggregator.getUpdateTriggers(this.props);\n  }\n\n  renderLayers() {\n    const {\n      elevationScale,\n      extruded,\n      coverage,\n      material,\n      transitions\n    } = this.props;\n    const {\n      angle,\n      radius,\n      cpuAggregator,\n      vertices\n    } = this.state;\n    const SubLayerClass = this.getSubLayerClass('hexagon-cell', ColumnLayer);\n\n    const updateTriggers = this._getSublayerUpdateTriggers();\n\n    const geometry = vertices && vertices.length ? {\n      vertices,\n      radius: 1\n    } : {\n      radius,\n      angle\n    };\n    return new SubLayerClass({ ...geometry,\n      diskResolution: 6,\n      elevationScale,\n      extruded,\n      coverage,\n      material,\n      getFillColor: this._onGetSublayerColor.bind(this),\n      getElevation: this._onGetSublayerElevation.bind(this),\n      transitions: transitions && {\n        getFillColor: transitions.getColorValue || transitions.getColorWeight,\n        getElevation: transitions.getElevationValue || transitions.getElevationWeight\n      }\n    }, this.getSubLayerProps({\n      id: 'hexagon-cell',\n      updateTriggers\n    }), {\n      data: cpuAggregator.state.layerData.data\n    });\n  }\n\n}\nHexagonLayer.layerName = 'HexagonLayer';\nHexagonLayer.defaultProps = defaultProps;\n//# sourceMappingURL=hexagon-layer.js.map","import { hexbin } from 'd3-hexbin';\nimport { createIterable, log } from '@deck.gl/core';\nexport function pointToHexbin(props, aggregationParams) {\n  const {\n    data,\n    radius\n  } = props;\n  const {\n    viewport,\n    attributes\n  } = aggregationParams;\n  const centerLngLat = data.length ? getPointsCenter(data, aggregationParams) : null;\n  const radiusCommon = getRadiusInCommon(radius, viewport, centerLngLat);\n  const screenPoints = [];\n  const {\n    iterable,\n    objectInfo\n  } = createIterable(data);\n  const positions = attributes.positions.value;\n  const {\n    size\n  } = attributes.positions.getAccessor();\n\n  for (const object of iterable) {\n    objectInfo.index++;\n    const posIndex = objectInfo.index * size;\n    const position = [positions[posIndex], positions[posIndex + 1]];\n    const arrayIsFinite = Number.isFinite(position[0]) && Number.isFinite(position[1]);\n\n    if (arrayIsFinite) {\n      screenPoints.push({\n        screenCoord: viewport.projectFlat(position),\n        source: object,\n        index: objectInfo.index\n      });\n    } else {\n      log.warn('HexagonLayer: invalid position')();\n    }\n  }\n\n  const newHexbin = hexbin().radius(radiusCommon).x(d => d.screenCoord[0]).y(d => d.screenCoord[1]);\n  const hexagonBins = newHexbin(screenPoints);\n  return {\n    hexagons: hexagonBins.map((hex, index) => ({\n      position: viewport.unprojectFlat([hex.x, hex.y]),\n      points: hex,\n      index\n    })),\n    radiusCommon\n  };\n}\nexport function getPointsCenter(data, aggregationParams) {\n  const {\n    attributes\n  } = aggregationParams;\n  const positions = attributes.positions.value;\n  const {\n    size\n  } = attributes.positions.getAccessor();\n  let minX = Infinity;\n  let minY = Infinity;\n  let maxX = -Infinity;\n  let maxY = -Infinity;\n  let i;\n\n  for (i = 0; i < size * data.length; i += size) {\n    const x = positions[i];\n    const y = positions[i + 1];\n    const arrayIsFinite = Number.isFinite(x) && Number.isFinite(y);\n\n    if (arrayIsFinite) {\n      minX = Math.min(x, minX);\n      maxX = Math.max(x, maxX);\n      minY = Math.min(y, minY);\n      maxY = Math.max(y, maxY);\n    }\n  }\n\n  return [minX, minY, maxX, maxY].every(Number.isFinite) ? [(minX + maxX) / 2, (minY + maxY) / 2] : null;\n}\nexport function getRadiusInCommon(radius, viewport, center) {\n  const {\n    unitsPerMeter\n  } = viewport.getDistanceScales(center);\n  return radius * unitsPerMeter[0];\n}\n//# sourceMappingURL=hexagon-aggregator.js.map","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { HexagonLayer } from 'deck.gl';\nimport React from 'react';\nimport { t } from '@superset-ui/core';\n\nimport { commonLayerProps, getAggFunc } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { createDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\n\nfunction setTooltipContent(o) {\n  return (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        label={`${t('Centroid (Longitude and Latitude)')}: `}\n        value={`(${o.coordinate[0]}, ${o.coordinate[1]})`}\n      />\n      <TooltipRow\n        label={`${t('Height')}: `}\n        value={`${o.object.elevationValue}`}\n      />\n    </div>\n  );\n}\n\nexport function getLayer(formData, payload, onAddFilter, setTooltip) {\n  const fd = formData;\n  const c = fd.color_picker;\n  let data = payload.data.features.map(d => ({\n    ...d,\n    color: [c.r, c.g, c.b, 255 * c.a],\n  }));\n\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n  const aggFunc = getAggFunc(fd.js_agg_function, p => p.weight);\n\n  return new HexagonLayer({\n    id: `hex-layer-${fd.slice_id}`,\n    data,\n    pickable: true,\n    radius: fd.grid_size,\n    minColor: [0, 0, 0, 0],\n    extruded: fd.extruded,\n    maxColor: [c.r, c.g, c.b, 255 * c.a],\n    outline: false,\n    getElevationValue: aggFunc,\n    getColorValue: aggFunc,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nfunction getPoints(data) {\n  return data.map(d => d.position);\n}\n\nexport default createDeckGLComponent(getLayer, getPoints);\n","/* eslint-disable react/no-array-index-key */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { PathLayer } from 'deck.gl';\nimport React from 'react';\nimport { commonLayerProps } from '../common';\nimport sandboxedEval from '../../utils/sandbox';\nimport { createDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\n\nfunction setTooltipContent(o) {\n  return (\n    o.object.extraProps && (\n      <div className=\"deckgl-tooltip\">\n        {Object.keys(o.object.extraProps).map((prop, index) => (\n          <TooltipRow\n            key={`prop-${index}`}\n            label={`${prop}: `}\n            value={`${o.object.extraProps[prop]}`}\n          />\n        ))}\n      </div>\n    )\n  );\n}\n\nexport function getLayer(formData, payload, onAddFilter, setTooltip) {\n  const fd = formData;\n  const c = fd.color_picker;\n  const fixedColor = [c.r, c.g, c.b, 255 * c.a];\n  let data = payload.data.features.map(feature => ({\n    ...feature,\n    path: feature.path,\n    width: fd.line_width,\n    color: fixedColor,\n  }));\n\n  if (fd.js_data_mutator) {\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n\n  return new PathLayer({\n    id: `path-layer-${fd.slice_id}`,\n    getColor: d => d.color,\n    getPath: d => d.path,\n    getWidth: d => d.width,\n    data,\n    rounded: true,\n    widthScale: 1,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nfunction getPoints(data) {\n  let points = [];\n  data.forEach(d => {\n    points = points.concat(d.path);\n  });\n\n  return points;\n}\n\nexport default createDeckGLComponent(getLayer, getPoints);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { roundDecimal } from './utils';\n\nexport const defaultViewport = {\n  bearing: 0,\n  latitude: 31.222656842808707,\n  longitude: 6.85236157047845,\n  pitch: 0,\n  zoom: 1,\n};\n\nconst METER_TO_MILE = 1609.34;\n\nexport function unitToRadius(unit, num) {\n  if (unit === 'square_m') {\n    return Math.sqrt(num / Math.PI);\n  }\n  if (unit === 'radius_m') {\n    return num;\n  }\n  if (unit === 'radius_km') {\n    return num * 1000;\n  }\n  if (unit === 'radius_miles') {\n    return num * METER_TO_MILE;\n  }\n  if (unit === 'square_km') {\n    return Math.sqrt(num / Math.PI) * 1000;\n  }\n  if (unit === 'square_miles') {\n    return Math.sqrt(num / Math.PI) * METER_TO_MILE;\n  }\n\n  return null;\n}\n\nexport const EARTH_CIRCUMFERENCE_KM = 40075.16;\nexport const MILES_PER_KM = 1.60934;\n\nexport function kmToPixels(kilometers, latitude, zoomLevel) {\n  // Algorithm from: https://wiki.openstreetmap.org/wiki/Zoom_levels\n  const latitudeRad = latitude * (Math.PI / 180);\n  // Seems like the zoomLevel is off by one\n  const kmPerPixel =\n    (EARTH_CIRCUMFERENCE_KM * Math.cos(latitudeRad)) / 2 ** (zoomLevel + 9);\n\n  return roundDecimal(kilometers / kmPerPixel, 2);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ScatterplotLayer } from 'deck.gl';\nimport React from 'react';\nimport { getMetricLabel, t } from '@superset-ui/core';\nimport { commonLayerProps } from '../common';\nimport { createCategoricalDeckGLComponent } from '../../factory';\nimport TooltipRow from '../../TooltipRow';\nimport { unitToRadius } from '../../utils/geo';\n\nfunction getPoints(data) {\n  return data.map(d => d.position);\n}\n\nfunction setTooltipContent(formData, verboseMap) {\n  return o => {\n    const label =\n      verboseMap?.[formData.point_radius_fixed.value] ||\n      getMetricLabel(formData.point_radius_fixed?.value);\n    return (\n      <div className=\"deckgl-tooltip\">\n        <TooltipRow\n          label={`${t('Longitude and Latitude')}: `}\n          value={`${o.object.position[0]}, ${o.object.position[1]}`}\n        />\n        {o.object.cat_color && (\n          <TooltipRow\n            label={`${t('Category')}: `}\n            value={`${o.object.cat_color}`}\n          />\n        )}\n        {o.object.metric && (\n          <TooltipRow label={`${label}: `} value={`${o.object.metric}`} />\n        )}\n      </div>\n    );\n  };\n}\n\nexport function getLayer(\n  formData,\n  payload,\n  onAddFilter,\n  setTooltip,\n  datasource,\n) {\n  const fd = formData;\n  const dataWithRadius = payload.data.features.map(d => {\n    let radius = unitToRadius(fd.point_unit, d.radius) || 10;\n    if (fd.multiplier) {\n      radius *= fd.multiplier;\n    }\n    if (d.color) {\n      return { ...d, radius };\n    }\n    const c = fd.color_picker || { r: 0, g: 0, b: 0, a: 1 };\n    const color = [c.r, c.g, c.b, c.a * 255];\n\n    return { ...d, radius, color };\n  });\n\n  return new ScatterplotLayer({\n    id: `scatter-layer-${fd.slice_id}`,\n    data: dataWithRadius,\n    fp64: true,\n    getFillColor: d => d.color,\n    getRadius: d => d.radius,\n    radiusMinPixels: fd.min_radius || null,\n    radiusMaxPixels: fd.max_radius || null,\n    stroked: false,\n    ...commonLayerProps(\n      fd,\n      setTooltip,\n      setTooltipContent(fd, datasource?.verboseMap),\n    ),\n  });\n}\n\nexport default createCategoricalDeckGLComponent(getLayer, getPoints);\n"],"names":["getExploreLongUrl","formData","endpointType","allowOverflow","extraSearch","datasource","uri","URI","directory","includes","getURIDirectory","search","Object","keys","forEach","key","form_data","object","cache","Set","JSON","stringify","value","has","parse","error","add","safeStringify","standalone","url","toString","length","viz_type","URL_IS_TOO_LONG_TO_SHARE","deck_grid","deck_screengrid","deck_path","deck_hex","deck_scatter","deck_geojson","deck_arc","deck_polygon","propTypes","PropTypes","payload","setControlValue","viewport","onAddFilter","onSelect","defaultProps","DeckMulti","React","constructor","props","super","containerRef","setTooltip","tooltip","current","this","state","subSlicesLayers","onViewportChange","bind","componentDidMount","loadLayers","UNSAFE_componentWillReceiveProps","nextProps","deck_slices","setState","data","slices","subslice","filters","extra_filters","subsliceCopy","SupersetClient","endpoint","then","json","layer","layerGenerators","slice_id","catch","render","height","width","layers","values","DeckGLContainer","ref","mapboxApiAccessToken","mapboxApiKey","mapStyle","mapbox_style","propertyMap","fillColor","color","fill","strokeColor","alterProps","propOverrides","newProps","k","hexToRGB","features","recurseGeoJson","node","extraProps","obj","geometry","newNode","properties","push","setTooltipContent","o","className","map","prop","index","label","getFillColor","feature","getLineColor","getLayer","fd","fc","fill_color_picker","sc","stroke_color_picker","r","g","b","a","jsFnMutator","js_data_mutator","sandboxedEval","GeoJsonLayer","id","filled","stroked","extruded","pointRadiusScale","point_radius_scale","getLineWidth","line_width","commonLayerProps","DeckGLGeoJson","autozoom","points","reduce","acc","bounds","geojsonExtent","fitViewport","t","coordinate","elevationValue","c","color_picker","d","aggFunc","getAggFunc","js_agg_function","p","weight","GridLayer","pickable","cellSize","grid_size","minColor","maxColor","outline","getElevationValue","getColorValue","createDeckGLComponent","position","thirdPi","Math","PI","angles","pointX","pointY","nop","colorDomain","colorRange","type","getColorWeight","colorAggregation","lowerPercentile","min","max","upperPercentile","colorScaleType","onSetColorDomain","elevationDomain","elevationRange","getElevationWeight","elevationAggregation","elevationLowerPercentile","elevationUpperPercentile","elevationScale","elevationScaleType","onSetElevationDomain","radius","coverage","hexagonAggregator","aggregationParams","attributes","centerLngLat","positions","size","getAccessor","i","minX","Infinity","minY","maxX","maxY","x","y","Number","isFinite","every","getPointsCenter","radiusCommon","center","unitsPerMeter","getDistanceScales","getRadiusInCommon","screenPoints","iterable","objectInfo","posIndex","screenCoord","projectFlat","source","log","newHexbin","dx","dy","x0","y0","x1","y1","hexbin","binsById","bins","n","isNaN","px","call","point","py","pj","round","pi","py1","abs","px1","pi2","pj2","px2","py2","bin","hexagon","angle","sin","cos","join","centers","j","mesh","fragment","slice","_","arguments","extent","hexagons","hex","unprojectFlat","getPosition","material","_filterData","optional","HexagonLayer","shouldUpdateState","changeFlags","somethingChanged","initializeState","cpuAggregator","getAggregator","getCellSize","aggregatorState","hexagonVertices","getAttributeManager","accessor","updateState","opts","oldVertices","propsOrDataChanged","context","getAttributes","layerData","vertices","convertLatLngToMeterOffset","updateRadiusAngle","Array","isArray","vertex0","vertex3","centroid","centroidFlat","metersPerUnit","vt","vtFlat","getPickingInfo","info","_onGetSublayerColor","cell","_onGetSublayerElevation","_getSublayerUpdateTriggers","getUpdateTriggers","renderLayers","transitions","SubLayerClass","getSubLayerClass","updateTriggers","diskResolution","getElevation","getSubLayerProps","layerName","TooltipRow","fixedColor","path","PathLayer","getColor","getPath","getWidth","rounded","widthScale","concat","METER_TO_MILE","verboseMap","point_radius_fixed","getMetricLabel","cat_color","metric","dataWithRadius","unit","point_unit","num","sqrt","multiplier","ScatterplotLayer","fp64","getRadius","radiusMinPixels","min_radius","radiusMaxPixels","max_radius","createCategoricalDeckGLComponent"],"sourceRoot":""}